name: rustconn
base: core24
version: '0.7.6'
summary: Manage remote connections easily
description: |
  RustConn is a modern connection manager for Linux with a GTK4/Wayland-native
  interface. Manage SSH, RDP, VNC, SPICE, and Zero Trust connections from a
  single application.

  Protocols (embedded Rust implementations):
  - SSH with embedded VTE terminal and split view
  - RDP via IronRDP (embedded)
  - VNC via vnc-rs (embedded)
  - SPICE via external remote-viewer (install on host)

  Zero Trust (install CLIs on host):
  - AWS SSM, GCP IAP, Azure Bastion, OCI Bastion
  - Cloudflare Tunnel, Teleport, Tailscale, Boundary

  Organization:
  - Groups, tags, and templates
  - Connection history and statistics
  - Session logging

  Import/Export:
  - Asbru-CM, Remmina, SSH config, Ansible inventory
  - Royal TS, MobaXterm, native format (.rcn)

  Security:
  - KeePassXC (KDBX files)
  - libsecret (GNOME Keyring)
  - Bitwarden CLI, 1Password CLI (install on host)

  Productivity:
  - Split terminals
  - Command snippets
  - Cluster commands
  - Wake-on-LAN

  Note: This snap uses strict confinement with embedded protocol clients.
  External CLIs (Zero Trust, password managers) must be installed on host
  and accessed via system-files interface.

grade: stable
confinement: strict
icon: rustconn/assets/icons/hicolor/256x256/apps/io.github.totoshko88.RustConn.png
license: GPL-3.0+
website: https://github.com/totoshko88/RustConn
source-code: https://github.com/totoshko88/RustConn
issues: https://github.com/totoshko88/RustConn/issues
donation: https://ko-fi.com/totoshko88
contact: totoshko88@gmail.com

platforms:
  amd64:
    build-on: [amd64]
    build-for: [amd64]

plugs:
  # GTK/Desktop integration
  gtk-3-themes:
    interface: content
    target: $SNAP/data-dir/themes
    default-provider: gtk-common-themes
  icon-themes:
    interface: content
    target: $SNAP/data-dir/icons
    default-provider: gtk-common-themes
  sound-themes:
    interface: content
    target: $SNAP/data-dir/sounds
    default-provider: gtk-common-themes
  
  # SSH access
  ssh-keys:
    interface: ssh-keys
  ssh-public-keys:
    interface: ssh-public-keys
  
  # Cloud credentials (requires manual connection)
  aws-credentials:
    interface: personal-files
    read:
      - $HOME/.aws
  gcloud-credentials:
    interface: personal-files
    read:
      - $HOME/.config/gcloud
  azure-credentials:
    interface: personal-files
    read:
      - $HOME/.azure
  oci-credentials:
    interface: personal-files
    read:
      - $HOME/.oci
  
  # KeePass databases (requires manual connection)
  keepass-databases:
    interface: personal-files
    read:
      - $HOME/Documents
      - $HOME/Dropbox
      - $HOME/OneDrive
  
  # Password manager configs (requires manual connection)
  bitwarden-config:
    interface: personal-files
    read:
      - $HOME/.config/Bitwarden CLI
  onepassword-config:
    interface: personal-files
    read:
      - $HOME/.config/op
  
  # Host-installed CLIs (requires manual connection)
  # Zero Trust CLIs
  host-aws-cli:
    interface: system-files
    read:
      - /usr/bin/aws
      - /usr/local/bin/aws
  host-gcloud-cli:
    interface: system-files
    read:
      - /usr/bin/gcloud
      - /usr/local/bin/gcloud
      - /snap/google-cloud-cli/current/bin/gcloud
  host-az-cli:
    interface: system-files
    read:
      - /usr/bin/az
      - /usr/local/bin/az
  host-oci-cli:
    interface: system-files
    read:
      - /usr/bin/oci
      - /usr/local/bin/oci
  host-tsh-cli:
    interface: system-files
    read:
      - /usr/bin/tsh
      - /usr/local/bin/tsh
  host-tailscale-cli:
    interface: system-files
    read:
      - /usr/bin/tailscale
      - /usr/local/bin/tailscale
  host-cloudflared-cli:
    interface: system-files
    read:
      - /usr/bin/cloudflared
      - /usr/local/bin/cloudflared
  host-boundary-cli:
    interface: system-files
    read:
      - /usr/bin/boundary
      - /usr/local/bin/boundary
  # Password manager CLIs
  host-bw-cli:
    interface: system-files
    read:
      - /usr/bin/bw
      - /usr/local/bin/bw
  host-op-cli:
    interface: system-files
    read:
      - /usr/bin/op
      - /usr/local/bin/op
  # SPICE client (external only)
  host-spice-client:
    interface: system-files
    read:
      - /usr/bin/remote-viewer
      - /usr/local/bin/remote-viewer

apps:
  rustconn:
    command: usr/bin/rustconn
    desktop: usr/share/applications/io.github.totoshko88.RustConn.desktop
    common-id: io.github.totoshko88.RustConn
    extensions: [gnome]
    plugs:
      - home
      - network
      - network-bind
      - audio-playback
      - desktop
      - desktop-legacy
      - wayland
      - x11
      - unity7
      - gsettings
      - ssh-keys
      - ssh-public-keys
      - aws-credentials
      - gcloud-credentials
      - azure-credentials
      - oci-credentials
      - keepass-databases
      - bitwarden-config
      - onepassword-config
      - host-aws-cli
      - host-gcloud-cli
      - host-az-cli
      - host-oci-cli
      - host-tsh-cli
      - host-tailscale-cli
      - host-cloudflared-cli
      - host-boundary-cli
      - host-bw-cli
      - host-op-cli
      - host-spice-client
    environment:
      PATH: $SNAP/usr/bin:$SNAP/bin:/usr/local/bin:/usr/bin:$PATH
      SSH_CONFIG_DIR: $SNAP_USER_DATA/.ssh
      RUSTCONN_DATA_DIR: $SNAP_USER_DATA
  
  rustconn-cli:
    command: usr/bin/rustconn-cli
    plugs:
      - home
      - network
      - ssh-keys
      - ssh-public-keys
    environment:
      PATH: $SNAP/usr/bin:$SNAP/bin:/usr/local/bin:/usr/bin:$PATH
      SSH_CONFIG_DIR: $SNAP_USER_DATA/.ssh
      RUSTCONN_DATA_DIR: $SNAP_USER_DATA

parts:
  rustconn:
    plugin: rust
    source: .
    rust-channel: "1.88"
    rust-path: [rustconn, rustconn-cli]
    rust-use-global-lto: true
    rust-features: [tray, vnc-embedded, rdp-embedded, rdp-audio]
    build-packages:
      - libgtk-4-dev
      - libadwaita-1-dev
      - libvte-2.91-gtk4-dev
      - libssl-dev
      - libasound2-dev
      - pkg-config
      - clang
      - cmake
    stage-packages:
      - libgtk-4-1
      - libadwaita-1-0
      - libvte-2.91-gtk4-0
      - libasound2t64
      - libssl3t64
      - openssh-client
    organize:
      bin/rustconn: usr/bin/rustconn
      bin/rustconn-cli: usr/bin/rustconn-cli
    override-build: |
      craftctl default
      mkdir -p $CRAFT_PART_INSTALL/usr/share/applications
      mkdir -p $CRAFT_PART_INSTALL/usr/share/icons
      mkdir -p $CRAFT_PART_INSTALL/usr/share/metainfo
      cp rustconn/assets/io.github.totoshko88.RustConn.desktop $CRAFT_PART_INSTALL/usr/share/applications/
      cp rustconn/assets/io.github.totoshko88.RustConn.metainfo.xml $CRAFT_PART_INSTALL/usr/share/metainfo/
      cp -r rustconn/assets/icons/hicolor $CRAFT_PART_INSTALL/usr/share/icons/
